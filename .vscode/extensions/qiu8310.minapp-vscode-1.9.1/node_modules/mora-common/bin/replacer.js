#!/usr/bin/env node
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var helper_1 = require("../helper");
var cli = require("mora-scripts/libs/tty/cli");
var fs = require("fs");
var path = require("path");
cli({
    usage: 'replacer <TsFolders, orTsFiles, ...>'
})
    .options({
    'm | modules': '<array> 指定模块'
})
    .parse(function (res) {
    if (!res.modules)
        return this.error('需要指定要解析的引用模块名称');
    res.modules = res.modules.map(function (m) { return ({ name: m }); });
    var refs = [];
    Object.defineProperty(res, 'refs', { set: function (value) { refs.push.apply(refs, value.filter(function (v) { return refs.indexOf(v) < 0; })); } });
    res._.forEach(function (file) { return doFile(path.resolve(file), res); });
    refs.sort();
    console.log(refs);
});
function doFile(file, res) {
    var stats = fs.statSync(file);
    if (stats.isDirectory()) {
        doFolder(file, res);
    }
    else if (stats.isFile()) {
        doTextFile(file, res);
    }
}
function doFolder(folder, res) {
    fs.readdirSync(folder).forEach(function (name) {
        doFile(path.join(folder, name), res);
    });
}
function doTextFile(textfile, res) {
    if (/\.tsx?/.test(textfile)) {
        res.refs = helper_1.replacer(textfile, res.modules).refModules;
    }
}
